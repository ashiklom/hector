<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Terrestrial C cycle • hector</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Terrestrial C cycle">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">hector</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/manual/index.html">Manual</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/intro-to-hector.html">A tour of the Hector R interface</a>
    </li>
    <li>
      <a href="../../articles/hector_apply.html">Example: Using Hector to solve for an emissions pathway</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JGCRI/hector">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Terrestrial C cycle</h1>
            
      
      
      <div class="hidden name"><code>SimpleNBox.Rmd</code></div>

    </div>

    
    
<p>Contents:</p>
<ul>
<li>
<a href="#simplenbox-science">Scientific basis</a> behind the terrestrial C cycle</li>
<li><a href="#simplenbox-implementation">Implementation details</a></li>
</ul>
<div id="simplenbox-science" class="section level1">
<h1 class="hasAnchor">
<a href="#simplenbox-science" class="anchor"></a>Science</h1>
<p>Hector’s land C sink is divided into three pools: vegetation (<span class="math inline">\(C_v\)</span>), detritus (<span class="math inline">\(C_d\)</span>), and soil (<span class="math inline">\(C_s\)</span>). These sinks be global (default), or can be divided into <span class="math inline">\(n\)</span> “biomes” with unique initial pool sizes and parameters. The total C flux from atmosphere to land at time <span class="math inline">\(t\)</span> (<span class="math inline">\(F_{L}(t)\)</span>) is the net of C sequestration by photosynthesis (net primary productivity, <span class="math inline">\(NPP_i(t)\)</span>) and C release by heterotrophic respiration (<span class="math inline">\(RH(t)\)</span>), summed across each biome <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[ F_{L}(t) = \sum_{i=1}^{n} \left( NPP_i(t) - RH_i(t) \right) \]</span></p>
<p>NPP is calculated as the product of a user-specified pre-industrial value (<span class="math inline">\(NPP_0\)</span>, default is 50 PgC/year) and a CO<sub>2</sub> fertilization multiplier (<span class="math inline">\(f(C_{atm}, \beta)\)</span>), which in turn is a function of the current atmospheric CO<sub>2</sub> concentration (<span class="math inline">\(C_{atm}\)</span>), the initial (“pre-industrial”) CO<sub>2</sub> concentration (<span class="math inline">\(C_0\)</span>), and biome-specific CO<sub>2</sub> fertilization parameter <span class="math inline">\(\beta_i\)</span> (default = 0.36):</p>
<p><span class="math display">\[ NPP_i(t) = NPP_{0,i} \times f(C_{atm}, \beta_i) \]</span> <span class="math display">\[ f(C_{atm}, \beta_i) = 1 + \beta_i \left( log(\frac{C_{atm}}{C_0})\right) \]</span></p>
<p>Heterotrophic respiration occurs in soil (<span class="math inline">\(RH_s(t)\)</span>) and detritus (<span class="math inline">\(RH_d(t))\)</span>) as a function of biome-specific atmospheric temperature anomaly (<span class="math inline">\(T_i\)</span>, calculated as the global atmospheric temperature anomaly scaled by a biome-specific warming factor <span class="math inline">\(\delta\)</span>) and the size of the current soil and detritus C pools (<span class="math inline">\(C_s\)</span> and <span class="math inline">\(C_d\)</span>, respectively).</p>
<p><span class="math display">\[ T_i(t) = \delta \times T_G(t) \]</span> <span class="math display">\[ RH_s = 0.02 C_s Q_{10}^{T_{i}(t) / 10}\]</span> <span class="math display">\[ RH_d = 0.25 C_d Q_{10}^{T_{i}(t) / 10}\]</span></p>
<p>Note that the fractions of soil and detritus C available to respiration are hard-coded at 0.02 and 0.25, respectively.</p>
<p>In each biome at each time step, the vegetation pools change as follows (biome, <span class="math inline">\(i\)</span> and time, <span class="math inline">\(t\)</span> subscripts omitted for clarity): C gain from NPP is distributed to vegetation, detritus, and soil according to fractionation parameters <span class="math inline">\(f_{nv}\)</span>, <span class="math inline">\(f_{nd}\)</span>, and <span class="math inline">\(f_{ns}\)</span>, respectively. Similarly, each pool bears a fraction of the total C loss from land-use change (<span class="math inline">\(F_{LC}\)</span>), again according to fractions <span class="math inline">\(f_{lv}\)</span>, <span class="math inline">\(f_{ld}\)</span>, and <span class="math inline">\(f_{ls}\)</span>. The detritus and soil pools also lose C via heterotrophic respiration (<span class="math inline">\(RH_s\)</span> and <span class="math inline">\(RH_d\)</span>, respectively). Finally, a fixed fraction of vegetation C is transferred to detritus as litterfall (<span class="math inline">\(f_{vd}\)</span>), and a fraction of both vegetation (<span class="math inline">\(f_{vs}\)</span>) and detritus (<span class="math inline">\(f_{ds}\)</span>) are transferred to soil via decomposition.</p>
<p><span class="math display">\[ \frac{dC_v}{dt} = NPP f_{nv} - C_v (f_{vd} + f_{vs}) - F_{LC} f_{lv} \]</span> <span class="math display">\[ \frac{dC_s}{dt} = NPP f_{nd} + C_v f_{vd} - C_d f_{ds} - RH_d - F_{LC} f_{ld} \]</span> <span class="math display">\[ \frac{dC_d}{dt} = NPP f_{ns} + C_v f_{vs} + C_d f_{ds} - RH_s - F_{LC} f_{ls} \]</span></p>
<p>The entire terrestrial C cycle is summarized in the following diagram:</p>
<div class="figure">
<img src="../../../../../../Box%20Sync/Projects/hector_project/hector/vignettes/manual/hector_terrestrial_c.svg" alt=""><p class="caption">Summary of terrestrial C cycle in Hector.</p>
</div>
</div>
<div id="simplenbox-implementation" class="section level1">
<h1 class="hasAnchor">
<a href="#simplenbox-implementation" class="anchor"></a>Implementation</h1>
<p>Code for the terrestrial C cycle lives in <a href="https://github.com/jgcri/hector/blob/master/src/simpleNbox.cpp"><code>src/simpleNbox.cpp</code></a> file (with associated headers in <a href="https://github.com/JGCRI/hector/blob/master/inst/include/simpleNbox.hpp"><code>inst/include/simpleNbox.hpp</code></a>).</p>
<ul>
<li>
<code><a href="../../reference/newcore.html">newcore()</a></code>
<ul>
<li>
<code>SimpleNbox.init()</code>
<ul>
<li>Set initial values.</li>
<li>Register inputs and capabilities.</li>
</ul>
</li>
<li>
<code>SimpleNbox.setData()</code> – Set values from <code>[SimpleNbox]</code> section of INI file.</li>
<li>
<code>SimpleNbox.prepareToRun()</code>
<ul>
<li>Check that pools and parameters are correct size.</li>
<li>Point to ocean model</li>
<li>Check size of <code>Ftalbedo</code>
</li>
<li>Set atmospheric CO<sub>2</sub> concentration (<code>Ca</code>) and pool size (<code>atmos_c</code>) to initial value (<code>C0</code> / <code>coinit</code>)</li>
<li>Check values of <code>beta</code> and <code>q10_rh</code>
</li>
</ul>
</li>
</ul>
</li>
<li>
<code>reset(time = 0) --&gt; SimpleNbox.reset()</code>
<ul>
<li>Set current C values (<code>earth_c</code>, <code>atmos_c</code>, <code>Ca</code>, <code>veg_c</code>, <code>detritus_c</code>, <code>soil_c</code>) and a few additional variables (<code>residual</code>, <code>tempferts</code>, <code>tempfertd</code>) from their respective time-series variables (<code>earth_c_ts</code>, <code>atmos_c_ts</code>, <code>veg_c_tv</code>, etc.)</li>
<li>Calculate the CO<sub>2</sub> fertilization effect (<code>co2fert</code>) for each biome</li>
<li>Truncate all time-series to the current <code>time</code>
</li>
<li>Set <code>tcurrent</code> to <code>time</code>
</li>
<li>If using spin-up and <code>time</code> is less than the start date, re-run spin-up (<code>prepareToRun()</code>) – <code>run_spinup()</code>
<ul>
<li>
<code>SimpleNbox.run_spinup()</code> – Just runs <code>SimpleNbox.sanitychecks()</code>
</li>
<li>
<code>SimpleNbox.sanitychecks()</code>
<ul>
<li>Check that <code>(atmos|veg|detritus|soil)_c</code> pools, and <code>npp_flux0</code>, <code>C0</code>, and <code>Ca</code> are all greater than zero</li>
<li>Check that all fractions (<code>f_nppv</code>, <code>f_nppd</code>, <code>f_litterd</code>) are greater than zero and sum to 1</li>
</ul>
</li>
<li>
<code>CarbonCycleSolver.run_spinup()</code>
<ul>
<li>If this is the first time, set global “flat” C pool variable (<code>c</code>) to zero.</li>
<li>
<code>SimpleNbox.getCValues()</code> – Set <code>c_old</code>
<ul>
<li>Transfer pools from variables (<code>atmos_c</code>, <code>veg_c</code>, …) to <code>c</code>
</li>
</ul>
</li>
<li>
<code>SimpleNbox.run()</code>
<ul>
<li>Run <code>sanitychecks</code> (see above)</li>
<li>Set the <code>Tgav_record</code> time-series to the current value</li>
</ul>
</li>
<li>
<code>CarbonCycleSolver.run()</code>
<ul>
<li>
<code>getCValues()</code> – Set the flat <code>c</code> array to the current values</li>
<li>
<code>SimpleNbox.slowparameval()</code>
<ul>
<li>Set the current <code>Ca</code> to atmospheric <code>c</code> value</li>
<li>Calculate the CO<sub>2</sub> fertilization effect (<code>co2fert</code>)</li>
<li>Calculate the temperature anoamly (<code>Tgav</code>)</li>
<li>Get the last value of <code>tempferts</code>
</li>
<li>If in spinup, continue. Otherwise, calculate RH for detritus and soil based on Q10 and <code>Tgav</code>
</li>
</ul>
</li>
<li>Solve the ODE for the C cycle</li>
<li>
<code>SimpleNbox.stashCValues()</code> – Transfer ODE pools back to model pools
<ul>
<li>Pass values from <code>c</code> to <code>atmos_c</code>, <code>veg_c</code>, <code>detritus_c</code>, etc. Apportion to biomes according to fraction of NPP and RH in that biome.</li>
</ul>
</li>
</ul>
</li>
<li>Use <code>getCValues</code> to set <code>c_new</code> (as above), and take the difference</li>
<li>
<code>SimpleNbox.record_state()</code> – Store the current C cycle state.
<ul>
<li>Set time-series variables (e.g. <code>earth_c_ts</code>, <code>atmos_c_ts</code>, <code>veg_c_tv</code>, etc.) to their current values</li>
<li>Tell the ocean model to record its state</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code><a href="../../reference/run.html">run()</a></code></li>
</ul>
<div id="simplenbox-setdata" class="section level2">
<h2 class="hasAnchor">
<a href="#simplenbox-setdata" class="anchor"></a>Setting values</h2>
<p>The following values related to the terrestrial C cycle can be set via <code>setData</code>.</p>
<table class="table">
<colgroup>
<col width="24%">
<col width="8%">
<col width="15%">
<col width="15%">
<col width="11%">
<col width="8%">
<col width="10%">
<col width="3%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th>Description</th>
<th>Unit</th>
<th>C++ macro</th>
<th>R function</th>
<th>C++ variable</th>
<th>Needs date</th>
<th>Biome-specific</th>
<th>Set</th>
<th>Get</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Initial atmospheric CO<sub>2</sub> pool</td>
<td>PgC</td>
<td><code>D_ATMOSPHERIC_C</code></td>
<td><code><a href="../../reference/carboncycle.html">ATMOSPHERIC_C()</a></code></td>
<td><code>C0</code></td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Pre-industrial CO<sub>2</sub> concentration</td>
<td>ppmv CO<sub>2</sub>
</td>
<td><code>D_PREINDUSTRIAL_C02</code></td>
<td><code><a href="../../reference/parameters.html">PREINDUSTRIAL_CO2()</a></code></td>
<td><code>C0</code></td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Vegetation C pool</td>
<td>PgC</td>
<td><code>D_VEGC</code></td>
<td></td>
<td><code>veg_c</code></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>Detritus C pool</td>
<td>PgC</td>
<td><code>D_DETRITUSC</code></td>
<td></td>
<td><code>detritus_c</code></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Soil C pool</td>
<td>PgC</td>
<td><code>D_SOILC</code></td>
<td></td>
<td><code>soil_c</code></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>Radiative forcing from albedo</td>
<td>unitless</td>
<td><code>D_RF_T_ALBEDO</code></td>
<td><code><a href="../../reference/forcings.html">RF_T_ALBEDO()</a></code></td>
<td><code>Ftalbedo</code></td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Frac. NPP to vegetation</td>
<td>unitless</td>
<td><code>D_F_NPPV</code></td>
<td><code><a href="../../reference/parameters.html">F_NPPV()</a></code></td>
<td><code>f_nppv</code></td>
<td>No</td>
<td>No*</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>Frac. NPP to detritus</td>
<td>unitless</td>
<td><code>D_F_NPPD</code></td>
<td><code><a href="../../reference/parameters.html">F_NPPD()</a></code></td>
<td><code>f_nppd</code></td>
<td>No</td>
<td>No*</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Frac. veg. C to litter</td>
<td>unitless</td>
<td><code>D_F_LITTERD</code></td>
<td><code><a href="../../reference/parameters.html">F_LITTERD()</a></code></td>
<td><code>f_litterd</code></td>
<td>No</td>
<td>No*</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>Frac. LUC from vegetation</td>
<td>unitless</td>
<td><code>D_F_LUCV</code></td>
<td><code><a href="../../reference/parameters.html">F_LUCV()</a></code></td>
<td><code>f_lucv</code></td>
<td>No</td>
<td>No*</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Frac. LUC from detritus</td>
<td>unitless</td>
<td><code>D_F_LUCD</code></td>
<td><code><a href="../../reference/parameters.html">F_LUCD()</a></code></td>
<td><code>f_lucd</code></td>
<td>No</td>
<td>No*</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>Initial NPP flux</td>
<td>PgC / year</td>
<td><code>D_NPP_FLUX0</code></td>
<td></td>
<td><code>npp_flux0</code></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Fossil fuel CO<sub>2</sub> emissions</td>
<td>PgC / year</td>
<td><code>D_FFI_EMISSIONS</code></td>
<td><code><a href="../../reference/carboncycle.html">FFI_EMISSIONS()</a></code></td>
<td><code>ffiEmissions</code></td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>LUC emissions</td>
<td>PgC / year</td>
<td><code>D_LUC_EMISSIONS</code></td>
<td><code><a href="../../reference/carboncycle.html">LUC_EMISSIONS()</a></code></td>
<td><code>lucEmissions</code></td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Atmospheric CO2 constraint</td>
<td>ppmv CO<sub>2</sub>
</td>
<td><code>D_CA_CONSTRAIN</code></td>
<td></td>
<td><code>Ca_constrain</code></td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>CO<sub>2</sub> fertilization factor</td>
<td>unitless</td>
<td><code>D_BETA</code></td>
<td><code><a href="../../reference/parameters.html">BETA()</a></code></td>
<td><code>beta</code></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="odd">
<td>Biome warming multiplier</td>
<td>unitless</td>
<td><code>D_WARMINGFACTOR</code></td>
<td></td>
<td><code>warmingfactor</code></td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td></td>
</tr>
<tr class="even">
<td>RH temperature sensitivity</td>
<td>unitless</td>
<td><code>D_Q10_RH</code></td>
<td><code><a href="../../reference/parameters.html">Q10_RH()</a></code></td>
<td><code>q10_rh</code></td>
<td>No</td>
<td>No*</td>
<td>Yes</td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simplenbox-science">Science</a></li>
      <li>
<a href="#simplenbox-implementation">Implementation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#simplenbox-setdata">Setting values</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robert Link, Corinne Hartin, Ben Bond-Lamberty, Pralit Patel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
